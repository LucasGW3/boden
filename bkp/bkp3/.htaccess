# ---------------------------------------
# Segurança básica e comportamento
# ---------------------------------------
Options -Indexes -MultiViews
AddDefaultCharset UTF-8

# Bloqueia leitura via HTTP de arquivos sensíveis
<FilesMatch "^(db\.php|navbar\.php|favicon-96x96\.png\.bak)$">
  Require all denied
</FilesMatch>

# Bloqueia .env e similares
<FilesMatch "^\.env">
  Require all denied
</FilesMatch>

# Bloqueia qualquer acesso direto às pastas de código interno
# (auth/ e ui/ só devem ser usados por include/require)
<IfModule mod_rewrite.c>
RewriteEngine On
RewriteBase /

# --- BLOQUEIOS PRIMEIRO (antes de liberar arquivos reais) ---
# Bloqueia qualquer coisa em /auth ou /ui via URL
RewriteRule ^(?:auth|ui)(?:/|$) - [F,L]

# Bloqueia diretamente db.php pela URL
RewriteRule ^db\.php$ - [F,L]

# ---------------------------------------
# URLs "limpas" (sem .php) + rota padrão
# ---------------------------------------

# 1) Raiz -> /login (URL limpa)
RewriteRule ^$ login [R=302,L]

# 2) Se pedirem /arquivo.php e o arquivo existir, redireciona para /arquivo
RewriteCond %{THE_REQUEST} \s/([^\s?]+)\.php[?\s] [NC]
RewriteCond %{DOCUMENT_ROOT}/%1.php -f
RewriteRule ^ %1 [R=301,L]

# 3) Se pedirem /caminho (sem .php) e existir /caminho.php, entrega-o (sem redirecionar)
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{DOCUMENT_ROOT}/$1.php -f
RewriteRule ^(.+?)/?$ $1.php [L,QSA]

# 4) Arquivos e pastas reais (css/js/img etc.) seguem direto
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# 5) Qualquer outra rota cai no login (útil p/ primeira instalação)
RewriteRule ^ login.php [L,QSA]
</IfModule>
